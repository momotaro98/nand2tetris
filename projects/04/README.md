
### ### 4.2.1 概要 レジスタ

> DとAの2つのレジスタが存在する。Dはデータ値だけを保持するが、Aはデータレジスタとアドレスレジスタの2役を担う。
> つまり、命令の使われる状況に応じて、Aの中身はデータ値と解釈されるかまたはデータメモリ(または命令メモリ)のアドレスとして解釈される。
> まず第一にAレジスタはデータメモリへ直接アクセスするために利用される。

例 `D = Memory[516] - 1`の操作をしたい行いたい場合、以下のようにアセンブラを書く。

```
@516        // Aレジスタへアドレス(516)を入れる
D = M - 1   // アドレス先の値から1を引いたものをDレジスタに入れる
```

`M` は `Memory[A]` であり、つまり、メモリのアドレスA上の位置の値である。

### ### 4.2.2 A命令

> A命令はAレジスタに15ビットの値を設定するために用いられる。
> この命令を用いることで、特定の値をAレジスタに格納することができる。たとえば、@5という命令は、0000000000000101と等しく、5の2進数で表記した値をAレジスタに保存することができる。

> A命令は3つの異なる用途で使用することができる。

1. Aレジスタを用いて定数を代入する用途。
2. メモリ操作を行う用途。あらかじめAレジスタにメモリのアドレスを設定することでそのあとに続くC命令において、Aレジスタで指定したメモリ位置にあるデータを操作することができる。
3. 移動命令の用途。あらかじめAレジスタに移動先のメモリアドレスを読み込むことで、その後に続く移動を行うためのC命令(jump命令)を用いて、次に実行する命令の位置を移動することができる。

1つ目の例

```
@100 // Aレジスタに100の2進数を入れ込む
D=M  // Dレジスタに100が入る
```

2つ目の例

```
@sum // Aレジスタにsum変数に割り当てられたアドレス値(メモリ位置)が入る
M=0  // 該当メモリ位置の値に0が入る
```

3つ目の例

```
@END  // Aレジスタに(END)のシンボルの命令位置が入る
D;JGT // Dが0より大きい(JGT)ときに(END)へ移動する
```

### 4.2.3 C命令

> C命令はHackプラットフォーム(コンピュータ)において、プログラミングの中心的な役割を担う。
> この命令コードは、次の3つの質問に答えることができるように、その仕様が決められている。

1. 何を計算するか？
2. 計算した結果をどこに格納するか？
3. 次に何をするか？

1つ目について、ALUが命令に従って計算をする。(comp領域)

2つ目について、ALUの計算結果を、RAMメモリ、Aレジスタ、Dレジスタのどの組み合わせで選択するか。(dest領域)

3つ目について、PC(Program Counter)が次の命令位置を決定する。(jump領域)

### 4.2.5 入出力 スクリーン

> スクリーンの中身は8Kのメモリマップで表すことができ、このメモリマップのRAMアドレスは16384(0x4000)から始まる。
> 縦横が16bit✕32個である。
> なので、上からr番目の行で、左からc番目の列に位置するピクセルは RAM[16384+r*32+c/16]に位置するワードのc%16番目のビットに対応する。

```
@SCREEN  // スクリーンの左上隅に対応するアドレスがAレジスタに入る。
M = 1    // Memory[A]=1 であり、つまり、左上隅のピクセルを黒く塗りつぶす。
```